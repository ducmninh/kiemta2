@page
@model PCM_396.Pages.Matches.CreateModel
@{
    ViewData["Title"] = "Nh·∫≠p k·∫øt qu·∫£ tr·∫≠n ƒë·∫•u (Referee)";
}

<!-- Page Header -->
<div class="row mb-4">
    <div class="col-12">
        <div class="text-center">
            <h1 class="display-6 mb-2">
                <i class="bi bi-clipboard-check-fill text-warning"></i>
                Nh·∫≠p k·∫øt qu·∫£ tr·∫≠n ƒë·∫•u
            </h1>
            <p class="text-muted">
                <i class="bi bi-shield-fill-check"></i>
                Ch·ª©c nƒÉng d√†nh cho Tr·ªçng t√†i / Admin
            </p>
        </div>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-lg-10">
        <div class="card border-0 shadow-lg">
            <div class="card-header bg-warning text-dark py-4">
                <h4 class="mb-0">
                    <i class="bi bi-pencil-square me-2"></i>
                    Ghi nh·∫≠n k·∫øt qu·∫£
                </h4>
            </div>
            <div class="card-body p-4">
                <form method="post">
                    <!-- Th√¥ng tin tr·∫≠n ƒë·∫•u -->
                    <div class="card mb-4 border-primary">
                        <div class="card-header bg-primary bg-opacity-10">
                            <h5 class="mb-0">
                                <i class="bi bi-info-circle-fill text-primary me-2"></i>
                                Th√¥ng tin tr·∫≠n ƒë·∫•u
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label asp-for="Input.Format" class="form-label fw-bold">
                                        <i class="bi bi-diagram-3 text-primary me-2"></i>
                                        Lo·∫°i tr·∫≠n ƒë·∫•u *
                                    </label>
                                    <select asp-for="Input.Format" class="form-select form-select-lg" id="formatSelect">
                                        <option value="0">üéØ ƒê∆°n (Singles) - 1vs1</option>
                                        <option value="1">üë• ƒê√¥i (Doubles) - 2vs2</option>
                                    </select>
                                    <span asp-validation-for="Input.Format" class="text-danger"></span>
                                </div>
                                
                                <div class="col-md-6">
                                    <label asp-for="Input.ChallengeId" class="form-label fw-bold">
                                        <i class="bi bi-trophy text-warning me-2"></i>
                                        Thu·ªôc K√®o n√†o? (T√πy ch·ªçn)
                                    </label>
                                    <select asp-for="Input.ChallengeId" class="form-select form-select-lg">
                                        <option value="">-- Kh√¥ng c√≥ k√®o (ƒê√°nh t·ª± do) --</option>
                                        @foreach (var challenge in Model.AcceptedChallenges)
                                        {
                                            <option value="@challenge.Id">
                                                @challenge.Title (@challenge.Creator.FullName)
                                            </option>
                                        }
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ng∆∞·ªùi th·∫Øng -->
                    <div class="card mb-4 border-success">
                        <div class="card-header bg-success bg-opacity-10">
                            <h5 class="mb-0">
                                <i class="bi bi-trophy-fill text-success me-2"></i>
                                Ng∆∞·ªùi th·∫Øng (Winners)
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label asp-for="Input.Winner1Id" class="form-label fw-bold">
                                        <i class="bi bi-person-check-fill text-success me-2"></i>
                                        Winner 1 *
                                    </label>
                                    <select asp-for="Input.Winner1Id" class="form-select form-select-lg" required>
                                        <option value="">-- Ch·ªçn ng∆∞·ªùi ch∆°i --</option>
                                        @foreach (var member in Model.Members)
                                        {
                                            <option value="@member.Id">
                                                @member.FullName ‚≠ê Rank: @member.RankLevel.ToString("F1")
                                            </option>
                                        }
                                    </select>
                                    <span asp-validation-for="Input.Winner1Id" class="text-danger"></span>
                                </div>
                                
                                <div class="col-md-6" id="winner2Div">
                                    <label asp-for="Input.Winner2Id" class="form-label fw-bold">
                                        <i class="bi bi-person-check-fill text-success me-2"></i>
                                        Winner 2 (Ch·ªâ cho ƒê√¥i)
                                    </label>
                                    <select asp-for="Input.Winner2Id" class="form-select form-select-lg">
                                        <option value="">-- Ch·ªçn ng∆∞·ªùi ch∆°i --</option>
                                        @foreach (var member in Model.Members)
                                        {
                                            <option value="@member.Id">
                                                @member.FullName ‚≠ê Rank: @member.RankLevel.ToString("F1")
                                            </option>
                                        }
                                    </select>
                                    <span asp-validation-for="Input.Winner2Id" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ng∆∞·ªùi thua -->
                    <div class="card mb-4 border-danger">
                        <div class="card-header bg-danger bg-opacity-10">
                            <h5 class="mb-0">
                                <i class="bi bi-x-circle-fill text-danger me-2"></i>
                                Ng∆∞·ªùi thua (Losers)
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label asp-for="Input.Loser1Id" class="form-label fw-bold">
                                        <i class="bi bi-person-x-fill text-danger me-2"></i>
                                        Loser 1 *
                                    </label>
                                    <select asp-for="Input.Loser1Id" class="form-select form-select-lg" required>
                                        <option value="">-- Ch·ªçn ng∆∞·ªùi ch∆°i --</option>
                                        @foreach (var member in Model.Members)
                                        {
                                            <option value="@member.Id">
                                                @member.FullName ‚≠ê Rank: @member.RankLevel.ToString("F1")
                                            </option>
                                        }
                                    </select>
                                    <span asp-validation-for="Input.Loser1Id" class="text-danger"></span>
                                </div>
                                
                                <div class="col-md-6" id="loser2Div">
                                    <label asp-for="Input.Loser2Id" class="form-label fw-bold">
                                        <i class="bi bi-person-x-fill text-danger me-2"></i>
                                        Loser 2 (Ch·ªâ cho ƒê√¥i)
                                    </label>
                                    <select asp-for="Input.Loser2Id" class="form-select form-select-lg">
                                        <option value="">-- Ch·ªçn ng∆∞·ªùi ch∆°i --</option>
                                        @foreach (var member in Model.Members)
                                        {
                                            <option value="@member.Id">
                                                @member.FullName ‚≠ê Rank: @member.RankLevel.ToString("F1")
                                            </option>
                                        }
                                    </select>
                                    <span asp-validation-for="Input.Loser2Id" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- T√≠nh ƒëi·ªÉm -->
                    <div class="card mb-4 border-warning">
                        <div class="card-header bg-warning bg-opacity-10">
                            <h5 class="mb-0">
                                <i class="bi bi-calculator-fill text-warning me-2"></i>
                                C√†i ƒë·∫∑t ƒëi·ªÉm s·ªë
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="form-check form-switch">
                                <input asp-for="Input.IsRanked" class="form-check-input" type="checkbox" checked 
                                       style="width: 3em; height: 1.5em;" />
                                <label asp-for="Input.IsRanked" class="form-check-label fw-bold ms-2">
                                    <i class="bi bi-graph-up-arrow text-success"></i>
                                    T√≠nh ƒëi·ªÉm (IsRanked)
                                </label>
                            </div>
                            <div class="alert alert-warning border-0 mt-3 mb-0">
                                <i class="bi bi-info-circle-fill me-2"></i>
                                <strong>Quy t·∫Øc:</strong> Ng∆∞·ªùi th·∫Øng +0.1 ƒëi·ªÉm, ng∆∞·ªùi thua -0.1 ƒëi·ªÉm (t·ªëi thi·ªÉu 1.0)
                            </div>
                        </div>
                    </div>
                    
                    <hr class="my-4">
                    
                    <div class="d-grid gap-3 d-md-flex justify-content-md-end">
                        <a asp-page="/Index" class="btn btn-secondary btn-lg px-4">
                            <i class="bi bi-x-circle me-2"></i>
                            H·ªßy b·ªè
                        </a>
                        <button type="submit" class="btn btn-warning btn-lg px-5">
                            <i class="bi bi-save-fill me-2"></i>
                            L∆∞u k·∫øt qu·∫£
                        </button>
                    </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Logic hi·ªÉn th·ªã/·∫©n Winner2 v√† Loser2 d·ª±a v√†o Format
        document.getElementById('formatSelect').addEventListener('change', function() {
            var format = this.value;
            var winner2Div = document.getElementById('winner2Div');
            var loser2Div = document.getElementById('loser2Div');
            
            if (format == '1') { // Doubles
                winner2Div.style.display = 'block';
                loser2Div.style.display = 'block';
            } else { // Singles
                winner2Div.style.display = 'none';
                loser2Div.style.display = 'none';
                document.querySelector('[name="Input.Winner2Id"]').value = '';
                document.querySelector('[name="Input.Loser2Id"]').value = '';
            }
        });
        
        // Kh·ªüi t·∫°o ban ƒë·∫ßu
        document.getElementById('formatSelect').dispatchEvent(new Event('change'));
    </script>
}
